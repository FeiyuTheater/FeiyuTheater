---
layout: default
---
<!-- _layouts/work-detail.html -->

<!-- Hero Banner Section -->
<section class="work-detail-banner">
    <div class="banner-image" style="background-image: url('{{ page.work_details.banner_image }}');"></div>
    <div class="banner-overlay">
        <div class="banner-content">
            <h1 class="work-title">{{ page.work_details.title }}</h1>
            <div class="work-meta">
                <span class="work-location">{{ page.work_details.location }}</span>
                <span class="work-date">{{ page.work_details.date }}</span>
            </div>
        </div>
    </div>
</section>

<!-- Introduction Section -->
<section class="detail-section introduction-section">
    <div class="container">
        <h2 class="section-title">
            <span class="title-dash">——</span>
            剧情简介
            <span class="title-dash">——</span>
        </h2>
        <div class="section-content">
            <p class="introduction-text">{{ page.work_details.introduction }}</p>
        </div>
    </div>
</section>

<!-- Poster and Production Team Section -->
<section class="detail-section poster-cast-section">
    <div class="container">
        <h2 class="section-title">
            <span class="title-dash">——</span>
            制作团队
            <span class="title-dash">——</span>
        </h2>
        <div class="section-content">
            <div class="poster-cast-grid">
                <div class="poster-container">
                    <img src="{{ page.work_details.poster_image }}" alt="{{ page.work_details.title }} 海报"
                        class="work-poster">
                </div>
                <div class="cast-container">
                    <!-- Production Team Carousel -->
                    <div class="production-team-carousel">
                        <!-- Navigation Arrows -->
                        <button class="carousel-nav carousel-prev" aria-label="上一页">
                            <span>‹</span>
                        </button>
                        <button class="carousel-nav carousel-next" aria-label="下一页">
                            <span>›</span>
                        </button>

                        <!-- Carousel Container -->
                        <div class="carousel-container">
                            <div class="carousel-track">
                                {% for team_page in page.work_details.production_team %}
                                <div class="carousel-slide">
                                    <h3 class="team-page-title">{{ team_page.page_title }}</h3>
                                    <div class="team-grid">
                                        {% for member in team_page.members %}
                                        <div class="team-member">
                                            <div class="member-info">
                                                <div class="character-name">{{ member.name }}</div>
                                                <div class="actor-name">{{ member.person }}</div>
                                                <div class="role-description">{{ member.role }}</div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Page Indicators -->
                        <div class="carousel-indicators">
                            {% for team_page in page.work_details.production_team %}
                            <button class="indicator{% if forloop.first %} active{% endif %}"
                                data-slide="{{ forloop.index0 }}">
                                {{ forloop.index }}
                            </button>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Video Section -->
<section class="detail-section video-section">
    <div class="container">
        <h2 class="section-title">
            <span class="title-dash">——</span>
            精彩片段
            <span class="title-dash">——</span>
        </h2>
        <div class="section-content">
            <div class="video-container">
                <iframe src="https://www.youtube.com/embed/{{ page.work_details.youtube_video }}" frameborder="0"
                    allowfullscreen class="youtube-video">
                </iframe>
            </div>
        </div>
    </div>
</section>

<!-- Photos Section -->
<section class="detail-section photos-section">
    <div class="container">
        <h2 class="section-title">
            <span class="title-dash">——</span>
            演出花絮
            <span class="title-dash">——</span>
        </h2>
        <div class="section-content">
            <div class="photo-wall">
                {% for photo in page.work_details.photos %}
                <div class="photo-item photo-{{ photo.size }}">
                    <img src="{{ photo.image }}" alt="{{ photo.caption }}" class="photo-image">
                    <div class="photo-caption">{{ photo.caption }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>

<!-- Custom content from markdown -->
<div class="custom-content">
    {{ content }}
</div>

<!-- JavaScript for Carousel -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const carousel = document.querySelector('.production-team-carousel');
        if (!carousel) return;

        const track = carousel.querySelector('.carousel-track');
        const slides = carousel.querySelectorAll('.carousel-slide');
        const nextBtn = carousel.querySelector('.carousel-next');
        const prevBtn = carousel.querySelector('.carousel-prev');
        const indicators = carousel.querySelectorAll('.indicator');

        let currentSlide = 0;
        let startX = 0;
        let currentX = 0;
        let isDragging = false;

        // Update carousel position
        function updateCarousel() {
            const translateX = -currentSlide * 100;
            track.style.transform = `translateX(${translateX}%)`;

            // Update indicators
            indicators.forEach((indicator, index) => {
                indicator.classList.toggle('active', index === currentSlide);
            });

            // Update button states
            prevBtn.style.opacity = currentSlide === 0 ? '0.5' : '1';
            nextBtn.style.opacity = currentSlide === slides.length - 1 ? '0.5' : '1';
        }

        // Next slide
        function nextSlide() {
            if (currentSlide < slides.length - 1) {
                currentSlide++;
                updateCarousel();
            }
        }

        // Previous slide
        function prevSlide() {
            if (currentSlide > 0) {
                currentSlide--;
                updateCarousel();
            }
        }

        // Go to specific slide
        function goToSlide(index) {
            currentSlide = index;
            updateCarousel();
        }

        // Event listeners for buttons
        nextBtn.addEventListener('click', nextSlide);
        prevBtn.addEventListener('click', prevSlide);

        // Event listeners for indicators
        indicators.forEach((indicator, index) => {
            indicator.addEventListener('click', () => goToSlide(index));
        });

        // Touch/swipe functionality
        track.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            isDragging = true;
            track.style.transition = 'none';
        });

        track.addEventListener('touchmove', (e) => {
            if (!isDragging) return;
            e.preventDefault();
            currentX = e.touches[0].clientX;
            const diffX = currentX - startX;
            const translateX = -currentSlide * 100 + (diffX / track.offsetWidth) * 100;
            track.style.transform = `translateX(${translateX}%)`;
        });

        track.addEventListener('touchend', (e) => {
            if (!isDragging) return;
            isDragging = false;
            track.style.transition = 'transform 0.3s ease';

            const diffX = currentX - startX;
            const threshold = track.offsetWidth * 0.2; // 20% of width

            if (Math.abs(diffX) > threshold) {
                if (diffX > 0 && currentSlide > 0) {
                    prevSlide();
                } else if (diffX < 0 && currentSlide < slides.length - 1) {
                    nextSlide();
                } else {
                    updateCarousel();
                }
            } else {
                updateCarousel();
            }
        });

        // Mouse drag functionality for desktop
        track.addEventListener('mousedown', (e) => {
            startX = e.clientX;
            isDragging = true;
            track.style.transition = 'none';
            track.style.cursor = 'grabbing';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            e.preventDefault();
            currentX = e.clientX;
            const diffX = currentX - startX;
            const translateX = -currentSlide * 100 + (diffX / track.offsetWidth) * 100;
            track.style.transform = `translateX(${translateX}%)`;
        });

        document.addEventListener('mouseup', (e) => {
            if (!isDragging) return;
            isDragging = false;
            track.style.transition = 'transform 0.3s ease';
            track.style.cursor = 'grab';

            const diffX = currentX - startX;
            const threshold = track.offsetWidth * 0.2;

            if (Math.abs(diffX) > threshold) {
                if (diffX > 0 && currentSlide > 0) {
                    prevSlide();
                } else if (diffX < 0 && currentSlide < slides.length - 1) {
                    nextSlide();
                } else {
                    updateCarousel();
                }
            } else {
                updateCarousel();
            }
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') {
                prevSlide();
            } else if (e.key === 'ArrowRight') {
                nextSlide();
            }
        });

        // Initialize
        updateCarousel();
    });
</script>